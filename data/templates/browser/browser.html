<!doctype html>
<html>
	<head>
		<title>Cloudbox</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="theme-color" content="#4096ee">
		<link rel="stylesheet" href="/assets/cloudbox.css" type="text/css">
		<link id="darkmode" rel="stylesheet" href="/assets/cloudbox-dark.css" type="text/css"{{if not .IsDarkMode}}disabled{{end}}>
		{{if not .GM13}}<script>var cloudbox = {}; cloudbox.GetPackage = function (type, id, rev) {window.location = "garrysmod://" + (type === "map" ? "install" : "spawn") + "/" + type + "/" + id + "/" + rev;}</script>{{end}}
		<script>
			var darkMode = {{.IsDarkMode}};
			function toggleMode() {
				darkMode = !darkMode;
				document.cookie = "darkmode="+darkMode+"; Path=/";
				if (darkMode) {
					document.getElementById("darkmode").removeAttribute("disabled");
				} else {
					document.getElementById("darkmode").setAttribute("disabled","disabled");
				}
				{{if .GM13}}
					cloudbox.ToggleDarkMode(darkMode);
				{{end}}
			}

			{{if .GM13}} 
				function forceMode(mode) {
					darkMode = !mode;
					toggleMode();
				}
				
				cloudbox.ToggleDarkMode(darkMode);
			{{end}}
		</script>
	</head>
	<body>
		<div class="header">
			{{template "categorybar" .}}
			{{if not .HomePage}}
				{{template "searchbar" .}}
				{{template "pagenav" .}}
			{{end}}
		</div>
		<div class="header" style="padding-bottom: 2px; -webkit-box-pack: justify">
			{{template "sortbar" .}}
			{{if and (.InGame) (eq .Category "savemap")}}
				{{template "savetools" .}}
			{{end}}
			<div class="subbar" style="margin-left:auto; margin-right: 52px;">
				<a id="togglemode" onclick="toggleMode()" title="Toggle Light/Dark Mode"><span class="navicon"></span></a>
				{{if .GM13}}
					<a id="settings" onclick="cloudbox.OpenSettings()"><span class="navicon"></span><span>Options</span></a>
				{{end}}
			</div>
		</div>
		
		<div class="topclouds"></div>
		<div class="metabox">
			<div class="metabox-target"></div>
		</div>
		<div class="bottomclouds"></div>
		<script>
			function animationTimeString(time, total) {
				return "-webkit-animation-delay: -" + (time.getSeconds() % total) + "." + (time.getMilliseconds()/1000).toFixed(3).substring(2) + "s;";
			}
			
			var animationTime = new Date();
			document.querySelector(".topclouds").setAttribute("style", animationTimeString(animationTime, 10));
			document.querySelector(".bottomclouds").setAttribute("style", animationTimeString(animationTime, 5));
		</script>
		
		{{if .HomePage}}
			<div class="content" style="padding-top:0; {{if ne .PageType "home"}}padding-bottom: 16px;{{end}}">
				{{if eq .PageType "home"}}
					{{template "home" .}}
				{{else if eq .PageType "news"}}
					{{template "news" .}}
				{{else if eq .PageType "info"}}
					{{template "info" .}}
				{{else if eq .PageType "error"}}
					<div class="pillbox">
						<h2>Page Not Found (404)</h2>
						<p>URL does not exist <span style="font-size: 22px;">&#x1F641;</span></p>
					</div>
				{{end}}
			</div>
		{{else}}
			<div class="content" style="text-align:center;">
				{{range .Packages}}
					{{if and ($.InGame) (eq $.Category "savemap") (ne $.MapName .Dataname)}}
						{{continue}}
					{{end}}
					{{template "item" .}}
				{{end}}
			</div>
		{{end}}
		<script>
			var items = document.querySelectorAll(".item");
			var metabox = document.querySelector(".metabox");
			var metaboxTarget = metabox.querySelector(".metabox-target");
			itemHover = function(e) {
				metabox.classList.add("active");
				metaboxTarget.innerHTML = this.querySelector(".metabox-template").innerHTML;
			};
			itemLeave = function(e) {
				metabox.classList.remove("active");
			};
			for (i=0; i<items.length; i++) {
				items[i].addEventListener("mouseover", itemHover);
				items[i].addEventListener("mouseout", itemLeave);
			}
		</script>
	</body>	
</html>
